{"version":3,"file":"ReactEditor.js","sources":["../../../lib/ReactEditor.tsx"],"sourcesContent":["import \"prismjs\";\nimport \"prismjs/components\";\nimport \"prismjs/components/prism-core\";\nimport \"prismjs/components/prism-clike\";\nimport \"prismjs/components/prism-javascript\";\nimport \"prismjs/components/prism-typescript\";\nimport \"prismjs/themes/prism-tomorrow.css\";\nimport CodeEditor from \"react-simple-code-editor\";\nexport default function EditorsHelper(props?: {\n  blockId?: string;\n  debug?: boolean;\n}) {\n  // @ts-ignore\n  const Prism = window.Prism;\n\n  const highlight = Prism.highlight;\n  const languages = Prism.languages;\n\n  const React = window.React;\n  const [input, setInput] = React.useState<string>(\"\");\n  const [isLoaded, setIsLoaded] = React.useState<boolean>(false);\n  const [messages, setMessages] = React.useState<\n    {\n      message: string;\n      name: string;\n      timestamp: number;\n    }[]\n  >([]);\n\n  const debug = props?.debug || false;\n  const setCompletionColumn = (message: string) => {\n    const promptForEditorColunist =\n      message.includes(\"?\") && !message.includes(\"->\")\n        ? message + \"-> \"\n        : message;\n\n    const xhr = new XMLHttpRequest();\n    const url = \"https://liu.academy/synth/ethics\";\n    xhr.open(\"POST\", url, true);\n    xhr.setRequestHeader(\"Content-Type\", \"application/json\");\n\n    xhr.onreadystatechange = function () {\n      if (xhr.readyState === 4) {\n        if (xhr.status === 200) {\n          console.info(\"Request succeeded\");\n\n          const theColumn = document.querySelector(\n            `${props?.blockId ? \"#editor-\" + props.blockId + \" > \" : \"\"}#typing`\n          );\n          if (theColumn) {\n            theColumn.classList.remove(\"active\");\n          }\n          const jsonstring = xhr.responseText;\n          let completion = \"\";\n          try {\n            const json = JSON.parse(jsonstring);\n            completion = json?.completion;\n          } catch (error) {\n            if (debug) {\n              console.log(error, \"error at json parse\");\n            }\n            completion = error?.toString() || \"error\";\n          }\n\n          const splitCompletionBySentences =\n            completion.match(/[^\\.!\\?]+[\\.!\\?]+/g) || [];\n\n          const messagesList = messages;\n\n          messagesList.push({\n            message: completion,\n            name: \"Synthethics\",\n            timestamp: Date.now(),\n          });\n\n          setMessages(messagesList);\n\n          console.log(\"completion\", completion);\n\n          console.log(\"messages\", messages);\n\n          setIsLoaded(true);\n        }\n      } else if (xhr.readyState === 3) {\n        if (debug) console.info(\"loading...\");\n      } else if (xhr.readyState === 2) {\n        if (debug) console.info(\"loaded\");\n      } else if (xhr.readyState === 1) {\n        if (debug) console.info(\"opened\");\n      }\n    };\n\n    const promptObj = {\n      prompt: promptForEditorColunist,\n    };\n    if (debug) {\n      console.info('Sending + \"' + JSON.stringify(promptObj) + '\"');\n    }\n    const theColumn = document.querySelector(\n      `${props?.blockId ? \"#editor-\" + props.blockId + \" > \" : \"\"}#typing`\n    );\n    console.log(\"theColumn\", theColumn);\n    if (theColumn) {\n      theColumn.classList.add(\"active\");\n    }\n    xhr.send(JSON.stringify(promptObj));\n  };\n\n  const send = () => {\n    const messagesList = messages;\n\n    messagesList.push({\n      message: input,\n      name: \"You\",\n      timestamp: Date.now(),\n    });\n\n    setMessages(messagesList);\n\n    setCompletionColumn(input);\n\n    setInput(\"\");\n  };\n\n  if (isLoaded === true) {\n    setIsLoaded(false);\n    setInput(\"\");\n  }\n  return (\n    <>\n      <div id=\"chat_box_body\" className=\"chat-box-body\">\n        <div id=\"chat_messages\">\n          {messages?.length === 0 ? (\n            <UserMessage\n              message=\"Welcome to Synthethics! Type a question to get started, e.g. 'What does ethics mean to Ziping Liu?'\"\n              name=\"Synthethics\"\n              timestamp={Date.now()}\n              userVisitor={false}\n            />\n          ) : (\n            messages?.map((message, index) => {\n              return (\n                <UserMessage\n                  message={message.message}\n                  name={message.name}\n                  timestamp={message.timestamp}\n                  key={index}\n                  userVisitor={message.name === \"You\" ? true : false}\n                />\n              );\n            })\n          )}\n        </div>\n      </div>\n      <div id=\"typing\">\n        <div>\n          <span /> <span /> <span /> <span className=\"n\">Synthethics</span> is\n          typing...\n        </div>\n      </div>\n      <div className=\"chat-box-footer\">\n        <CodeEditor\n          id=\"chat_input\"\n          placeholder=\"Enter your message here...\"\n          defaultValue={\"\"}\n          onValueChange={(value) => {\n            setInput(value);\n          }}\n          highlight={(code) => highlight(code, languages.ts, \"typescript\")}\n          value={input}\n          onKeyDown={(e) => {\n            if (e.key === \"Enter\") {\n              e.preventDefault();\n              e.stopPropagation();\n              send();\n            }\n          }}\n        />\n        <button\n          id=\"send\"\n          onClick={(e) => {\n            e.preventDefault();\n            send();\n          }}\n        >\n          <svg style={{ width: 24, height: 24 }} viewBox=\"0 0 24 24\">\n            <path fill=\"#006ae3\" d=\"M2,21L23,12L2,3V10L17,12L2,14V21Z\" />\n          </svg>\n        </button>\n      </div>\n    </>\n  );\n}\n\nfunction UserMessage(props: {\n  message: string;\n  name: string;\n  timestamp: number;\n  userVisitor: boolean;\n  style?: React.CSSProperties;\n}) {\n  const React = window.React;\n  return (\n    <>\n      <div\n        className={\n          props.userVisitor ? \"profile my-profile\" : \"profile other-profile\"\n        }\n      >\n        <img\n          src=\"https://images.unsplash.com/photo-1537396123722-b93d0acd8848?ixlib=rb-0.3.5&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=400&fit=max&ixid=eyJhcHBfaWQiOjE0NTg5fQ&s=efc6e85c24d3cfdd15cd36cb8a2471ed\"\n          width=\"30\"\n          height=\"30\"\n        />\n        <span>{props.name === \"You\" ? \"You™\" : \"Synthethics™\"}</span>\n      </div>\n      <div\n        className={`message ${\n          props.userVisitor ? \"my-message\" : \"other-message\"\n        }`}\n      >\n        {props.message}\n      </div>\n    </>\n  );\n}\n"],"names":["EditorsHelper","props","Prism","window","highlight","languages","React","_a","useState","input","setInput","_b","isLoaded","setIsLoaded","_c","messages","setMessages","debug","send","messagesList","push","message","name","timestamp","Date","now","promptForEditorColunist","includes","xhr","XMLHttpRequest","open","setRequestHeader","onreadystatechange","readyState","status","console","info","theColumn_1","document","querySelector","concat","blockId","classList","remove","jsonstring","responseText","completion","json","JSON","parse","error","log","toString","match","promptObj","prompt","stringify","theColumn","add","setCompletionColumn","createElement","Fragment","id","className","length","UserMessage","userVisitor","map","index","key","CodeEditor","placeholder","defaultValue","onValueChange","value","code","ts","onKeyDown","e","preventDefault","stopPropagation","onClick","style","width","height","viewBox","fill","d","src"],"mappings":"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"}